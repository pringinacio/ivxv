{#

IVXV Internet voting framework

Template file for rsyslog config in service host.

-#}
# IVXV Internet voting framework

# Rsyslog logging configuration file
# {{ cfg_filepath }}

# This file is automatically generated
# by collector management service! DO NOT CHANGE!

# load RELP output module
module(load="omrelp")

# increase max message size
global(maxMessageSize="32k")

# LOCAL LOGGING

# write IVXV log to file (up to level INFO)
if ($programname startswith 'ivxv-') and ($syslogfacility-text == 'local0') and
   ($syslogseverity <= '6') then
action(
    type="omfile"
    dynaFile="IVXV_DEFAULT_LOG_FILENAME"
    template="ivxv-json"
)

# write IVXV request log to /var/log/ivxv/ivxv-request-YYYY-MM-DD.log
if ($programname startswith 'ivxv-') and ($syslogfacility-text == 'local1') then
action(
    type="omfile"
    dynaFile="IVXV_REQUEST_LOG_FILENAME"
)

# write IVXV debug log and log of related
# services (haproxy, etcd, rsyslog, sshd) to /var/log/ivxv/ivxv-debug-YYYY-MM-DD.log
if ($programname startswith 'ivxv-') or ($programname startswith 'rsyslog') or
   ($programname == 'haproxy') or ($programname == 'sshd') or ($programname == 'etcd') then
action(
    type="omfile"
    dynaFile="IVXV_DEBUG_LOG_FILENAME"
)


# REMOTE LOGGING - log collector services
{% for log_collector in log_collectors %}
# forward log messages to log collector "{{ log_collector.id }}" using RELP protocol
action(
    type="omrelp"
    target="{{ log_collector.address }}"
    port="{{ log_collector.port }}"
)
{% else %}
# --- no log collectors defined ---
{% endfor %}

# REMOTE LOGGING - Log Monitor and other external log collectors
{% if ext_log_collectors %}
{% for log_collector in ext_log_collectors -%}
{% if loop.index == 1 %}
# forward log messages to Log Monitor using RELP protocol
if ($programname startswith 'ivxv-') and ($syslogfacility-text == 'local0') and
   ($syslogseverity <= '6') then
{% else %}
# forward log messages to external log collector using RELP protocol
{% endif -%}
action(
    type="omrelp"
    target="{{ log_collector.address }}"
    port="{{ log_collector.port }}"
)
{% endfor %}
{% else %}
# --- no log montitors defined ---
{% endif %}
{#-
vim:ft=jinja:
#}
