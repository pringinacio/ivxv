#!/bin/sh -eu

# tlsciphersuites: generates map from TLS cipher suite name to integer value.
# Creating the map by hand is too error-prone, so auto-generate it instead.

# Supported TLS cipher suites. Must be a subset of the constants defined in the
# crypto/tls package. When changing remember to update the documentation and
# administration service configuration validator.
#
# Currently we are only excluding cipher suites that use RC4 or 3DES.
ciphersuites="
TLS_RSA_WITH_AES_128_CBC_SHA
TLS_RSA_WITH_AES_256_CBC_SHA
TLS_RSA_WITH_AES_128_GCM_SHA256
TLS_RSA_WITH_AES_256_GCM_SHA384
TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA
TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA
TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA
TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA
TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
"

cat > "tlsciphersuites.go" <<HERE
// Generated by ivxv.ee/common/collector/server/tlsciphersuites. DO NOT EDIT!

package server

import "crypto/tls"

var $1 = map[string]uint16 {
$(for ciphersuite in $ciphersuites; do echo "\"$ciphersuite\": tls.$ciphersuite,"; done)
}
HERE
$GO fmt tlsciphersuites.go > /dev/null
